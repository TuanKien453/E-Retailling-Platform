@{
	Layout = null;

	var expirationString = Context.Session.GetString(SessionKeys.OtpExpiration.ToString());
	DateTime expirationTime;
	DateTime.TryParse(expirationString, out expirationTime);
}
<style>
	body {
		font-family: 'Arial', sans-serif; 
		background-color: #f8f9fa; 
		margin: 0; 
	}

	.height-100 {
		height: 100vh;
		display: flex;
		justify-content: center;
		align-items: center;
	}

	.card {
		width: 400px;
		border: none;
		height: auto; 
		padding: 20px;
		box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.1);
		border-radius: 8px; 
		background-color: #ffffff; 
		z-index: 1;
		text-align: center;
	}

		.card h6 {
			color: #dc3545; 
			font-size: 20px;
			margin-bottom: 15px; 
		}

	.inputs {
		margin: 20px 0; 
	}


		.inputs input:focus {
			outline: none; 
			border-color: #28a745; 
			box-shadow: 0 0 5px rgba(40, 167, 69, 0.5); 
		}

	.validate {
		border-radius: 5px; 
		height: 60px; 
		padding: 0 20px; 
		background-color: #dc3545; 
		border: none;
		color: white; 
		font-size: 18px; 
		transition: background-color 0.3s ease; 
	}

		.validate:hover {
			background-color: #c82333; 
		}

	.inputs input {
		width: 160px; 
		height: 60px; 
		font-size: 24px; 
		text-align: center; 
		border: 2px solid #dc3545;
		border-radius: 5px; 
	}

	#countdown {
		font-weight: bold; 
		margin-top: 15px; 
	}

	a {
		color: #007bff; 
		text-decoration: none; 
		display: block; 
		margin-top: 15px; 
	}

		a:hover {
			text-decoration: underline; 
		}
</style>
<div class="container height-100">
	<div class="card">
		<h6>Please enter the one-time password <br> to verify your account</h6>
		<div>
			@if (ViewBag.EmailMask != null)
			{
				<span>A code has been sent to</span> <small>@ViewBag.EmailMask</small>
			}
			else
			{
				<span>Please send OTP request</span> 
			}
		</div>

		<div id="countdown" class="mt-2 text-danger"></div>

		<form id="otpForm" asp-controller="CustomerForgotPassword" asp-action="VerifyOTP" method="post">
			<div id="otp" class="inputs mt-2">
				<input type="text" name="enteredOtp" required maxlength="6" />
			</div>
			<div class="mt-4">
				<button class="btn validate">Validate</button>
			</div><br />
			<div id="otp-error" class="alert alert-danger">@ViewBag.OtpError</div>
		</form>

		<a href="@Url.Action("SendOTP", "CustomerForgotPassword", new { emailTo = @ViewBag.Email })" class="btn btn-primary" id="resend">Resend OTP</a>
	</div>
</div>

<script src="lib/jquery/dist/jquery.min.js"></script>
<script>
	// Get the expiration time from the server
	var expirationTime = new Date('@expirationTime.ToString("yyyy-MM-ddTHH:mm:ssZ")');

	function updateCountdown() {
		var now = new Date();
		var remainingTime = expirationTime - now;

		if (remainingTime <= 0) {
			document.getElementById("countdown").textContent = "Your OTP has expired. Please request a new one!";
			// Disable the form if OTP has expired
			document.querySelectorAll('#otpForm input').forEach(input => {
				input.disabled = true; // Disable all inputs in the form
			});
			return;
		}

		var m = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
		var s = Math.floor((remainingTime % (1000 * 60)) / 1000);
		m = m < 10 ? "0" + m : m;
		s = s < 10 ? "0" + s : s;

		document.getElementById("countdown").innerHTML = `Time left: ${m} : ${s}`;
		setTimeout(updateCountdown, 1000);
	}

	updateCountdown();

	// AJAX form submission
	$("#otpForm").submit(function (e) {
		e.preventDefault(); // Prevent full page reload

		$.ajax({
			url: '@Url.Action("VerifyOTP", "CustomerForgotPassword")',
			type: 'POST',
			data: $(this).serialize(),
			success: function (response) {
				// Nếu xác thực thành công, chuyển hướng đến trang tiếp theo
				if (response.success) {

				} else {
					// Hiển thị thông báo lỗi
				}
			},
			error: function (xhr, status, error) {
				// Hiển thị lỗi nếu có
				$("#otp-error").text("An error occurred. Please try again.").show();
			}
		});
	});
</script>
